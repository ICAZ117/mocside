<template>
  <div class="darkBG">
	  <div class="row h-100">
		  <div class="col-3" style="border-right: 1px var(--FSCgrey) solid !important">
			  <div class="profile-picture">
				  <img src="this.user.pfp" alt="Profile" class="large-pfp" id="pfp">
				  <br>
			  </div>
		  </div>
		  <div class="col-9 settings" style="padding: 50px !important; height: 100%; color: #888">
			  <div class="profile-section">
				  <div class="editable">
					  <h3>Profile Options</h3>
					  <div class="row">
						  <div class="col-6">
							  <label for="Name">Name: </label>
							  <input class="profile-field" type="text" v-model="user.name" id="Name"/>
							  <br /><br />
							  <label for="pronouns">Preferred Pronouns: </label>
							  <input type="text" class="profile-field" name="pronouns" id="pronouns" v-model="user.pronouns">
						  </div>
						  <div class="col-6">
							  <label for="ScreenName">ScreenName: </label>
							  <input class="profile-field" type="text" v-model="user.screen_name" id="ScreenName">
							  <br /><br />
						  </div>
					  </div>
				  </div>
			  </div>
			  <div v-if="isProf" class="professor-section">
				  <h3>Edit Student</h3>
				  <div class="row">
					  <div class="col-6">
						  <label for="FSCID">FSC ID: </label>
						  <input class="profile-field" type="number" v-model="user.fsc_id" id="FSCID" disabled>
						  <br /><br />
						  <button @click="upgradeUser()" class="btn btn-danger btn-block">Upgrade User</button>
						  <button @click="downgradeUser()" class="btn btn-danger btn-block">DownGrade User</button>
					  </div>
					  <div class="col-6">
						  <label for="email">Email: </label>
						  <input class="profile-field" type="email" v-model="user.email" name="email" id="email" disabled>
						  <br /><br />
						  <button @click="deleteUser()" class="btn btn-danger btn-block">Delete User</button>
					  </div>
				  </div>
			  </div>
		  </div>
	  </div>

	  <div class="profile">
		    <img class="pfp" src="this.user.pfp" alt="Profile" id="pfp"/>
			<label for="Name">Name</label>
            <input type="text" v-model="user.name" id=Name disabled>
            <label for="ScreenName">ScreenName</label>
            <input type="text" v-model="user.screen_name" id="ScreenName" disabled>
			<label for="pronouns">Preferred Pronouns</label>
            <input type="text" name="pronouns" id="pronouns" v-model="user.pronouns" disabled>

			<!-- Professor Only-->
			<div class="Professor-Only" v-if="isProf">
				<label for="email">Email</label>
				<input type="email" v-model="user.email" id="email" disabled>
				<label for="FSCID">FSC ID</label>
				<input type="number" v-model="user.fsc_id" id="FSCID" disabled>
				<button @click="upgradeUser()" class="btn btn-danger btn-block">Upgrade User</button>
				<button @click="downgradeUser()" class="btn btn-danger btn-block">DownGrade User</button>
				<button @click="deleteUser()" class="btn btn-danger btn-block">Delete User</button>
			</div>
	  </div>
  </div>
</template>

<script>
import * as API from "../services/API";
import AuthService from "../services/AuthService";
import store from "../Store/index";
import { useRoute } from "vue-router";
export default {
	props: ['fsc_id'],
	data() {
		return {
			user: {
				pfp: "",
				name: "",
				screen_name: "",
				pronouns: "",
				email: "",
				fsc_id: "",
			},
			currentUser: {},
			studentID: "",
		}
	},
	methods: {
		async upgradeUser() {
			console.log("upgrade User");
			//post request
			const res = await API.apiClient.post(`/users/elevate/${this.fsc_id}`);
		},
		async downgradeUser() {
			console.log("downgrade User");

			const res = await API.apiClient.post(`/users/downgrade/${this.fsc_id}`);
		},
		async deleteUser() {
			console.log("delete User");
		},
		async getUser() {
			//api call to get currentUser
			const res = await API.apiClient.get(`/users/profile/${this.fsc_id}`);
			console.log(res);
			this.currentUser = res.data.data;

			//check if its empty
			if(this.currentUser.settings == null) {
				const res = await API.apiClient.post(`/profile/init`);
			}

			this.user.name = this.currentUser.name;
			this.user.email = this.currentUser.email;
			this.user.screen_name = this.currentUser.fsc_user.screen_name;
			this.user.fsc_id = this.currentUser.fsc_user.fsc_id;
			this.user.pronouns = this.currentUser.fsc_user.pronouns;

			this.user.pfp = this.currentUser.pfp_path;
			if(this.user.pfp == undefined || this.user.pfp == null || this.user.pfp == "") {
				this.user.pfp = "images/DefaultPFP.png?dca25dcd82b7a37cf8c8334dbf19eb69=";
			}
			document.getElementById("pfp").src = this.user.pfp;
			//write to check if the picture is loaded...if not then change back to default pfp
		},
	},
	computed: {
		isProf: function () {
			if (store.getters["auth/isProf"] == null) {
				return false;
			} else {
				return store.getters["auth/isProf"];
			}
		},
	},
	async beforeMount() {
		await this.getUser();
	},
}
</script>

<style>

</style>